---
created: 2021-12-27
updated: 2022-02-24
tags:
    - Computer-Graphics
---
`Swap Chain` 是一系列（大于等于2）用来渲染的缓冲，每次渲染内容刷新时 `Swap Chain` 中的第一个缓冲与当前渲染的缓冲会进行交换，这个过程称为 `Swapping` 或 `Flipping` 。

显示器内容的更新是逐像素的，利用一个叫做 `light pin` 的东西移动来进行像素更新。且通常是从显示器的最左上角像素开始，逐渐向右，向下进行更新，最后在显示器的右下角结束，当结束后 `light pin` 从右下角移动到左上角准备下一次的更新。

且通常渲染内容的更新速率是大于显示器内容的刷新率的（显示器内容的刷新率通常为60Hz，渲染内容的更新速率可能达到200+Hz）。因此如果显示器在刷新显示内容时，渲染内容发生了更新，那么很可能显示器上显示的内容上半部分是旧的图片，而下半部分是新的内容。这个现象被称为 `撕裂（Tearing）`

这个问题的一个解决方法是利用 `light pin` 从右下角移动到左上角的这个时间点，这个时间点被称为 `VSync`。这个时间中，显示器并不会进行渲染。如果限制渲染内容仅在 `VSync` 时进行更新，就可以避免因为渲染内容过快造成的撕裂。但如果渲染的内容过于复杂，即在 `VSync`的时间点还不足以更新完新内容，则同样会引发撕裂，只不过这一次是画面上半部分为新内容，下半部分是旧内容。

另一个解决方法则是通过 Swap Chain。思路是将更新的渲染内容放在一个离屏的缓冲中，该缓冲称为 `Back Buffer` ，而当前在显示器上渲染的缓冲称为 `Front Buffer` 。 `Back Buffer` 并不一定只有一块，因此称为 `Swap Chain`。

对 `Back Buffer` 的更新并不会影响 `Front Buffer` ，因此渲染内容的更新并以不一定要在 `VSync` 的时间点。显卡用指针来指向 `Back Buffer` 和 `Front Buffer` ，当需要更新画面时，只需要交换两个指针即可。

OpenGL 和 DX 都提供了相应的接口进行 `Swap Buffer` ，API 通常会使用队列存储交换缓冲的请求，在 `VSync` 时对两块缓冲进行实际的交换。

OpenGL 中对于 `Swap Buffer` 的操作逻辑，见 [Swap Buffer](Default%20Frambuffer.md#Swap%20Buffer)  部分。